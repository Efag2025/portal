<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - EFAG</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="estilo.css">
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="efag-logo-transparente.png" alt="EFAG Logo" />
    </div>
    <h2>Portal do Aluno</h2>

    <form id="loginForm">
      <div class="input-group">
        <input type="text" id="username" placeholder="Usuário" oninput="this.value=this.value.replace(/[^a-zA-Z]/g,'')" />
        <i class="fa fa-user"></i>
      </div>
      <div class="input-group">
        <input type="password" id="password" placeholder="Senha" maxlength="6" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
        <i class="fa fa-eye" id="togglePassword" onclick="togglePassword()"></i>
      </div>
      <button type="submit" id="loginBtn">
        <span id="btnText">Entrar</span>
        <div class="spinner" id="spinner"></div>
      </button>
      <div class="error-message" id="errorMsg">Preencha todos os campos.</div>
      <div class="extra-links">
        <a href="#" onclick="abrirModalEsqueciSenha(event)">Esqueci minha senha</a> |
        <a href="#" onclick="abrirCadastro(event)">Novo cadastro</a>
      </div>
    </form>

    <!-- Modal Esqueci a Senha -->
    <div id="modalEsqueciSenha" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999; justify-content:center; align-items:center;">
      <div style="background:#fff; padding:20px; border-radius:10px; max-width:300px; width:90%; text-align:left; position:relative;">
        <h3 style="text-align:center; margin-bottom:10px;">Recuperar senha</h3>
        <form id="recuperarForm">
          <div class="input-group">
            <input type="text" name="usuario" placeholder="Nome de usuário" required />
            <i class="fa fa-user"></i>
          </div>
          <div class="input-group">
            <input type="email" name="email" placeholder="E-mail cadastrado" required />
            <i class="fa fa-envelope"></i>
          </div>
          <button type="submit">Enviar solicitação</button>
          <p id="recuperarMsg" style="display:none; color:green; font-size:14px; text-align:center; margin-top:10px;">Solicitação enviada com sucesso!</p>
        </form>
        <div style="text-align:center; margin-top:10px;">
          <a href="#" onclick="fecharModalEsqueciSenha(event)" style="font-size:14px;">Fechar</a>
        </div>
      </div>
    </div>

<form id="cadastroForm">
      <div class="input-group">
        <input type="text" id="cadNome" placeholder="Nome completo" oninput="this.value=this.value.replace(/[^a-zA-ZÀ-ÿ\s]/g,'')" />
        <i class="fa fa-id-card"></i>
      </div>
      <div class="input-group">
        <input type="email" id="cadEmail" placeholder="E-mail" />
        <i class="fa fa-envelope"></i>
      </div>
      <div class="input-group">
        <input type="text" id="cadUsuario" placeholder="Nome de usuário (QRA)" oninput="this.value=this.value.replace(/[^a-zA-Z]/g,'')" />
        <i class="fa fa-user"></i>
      </div>
      <div class="input-group">
        <input type="password" id="cadSenha" placeholder="Senha" maxlength="6" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
        <i class="fa fa-eye" onclick="togglePassword(this, 'cadSenha')"></i>
      </div>
      <div class="input-group">
        <input type="text" id="cadPelotao" placeholder="Pelotão" maxlength="2" oninput="this.value=this.value.replace(/[^0-9]/g,'')" />
        <i class="fa fa-users"></i>
      </div>
      <button type="submit" id="cadastroBtn">Enviar cadastro</button>
      <div class="success-message" id="cadastroSuccess">Cadastro enviado com sucesso! Aguarde aprovação.</div>
      <div class="extra-links" style="text-align: center; margin-top: 10px;">
        <a href="#" onclick="voltarLogin(event)">Voltar ao login</a>
      </div>
    </form>
  </div>

  <script>
    function togglePassword(icon = null, inputId = 'password') {
      const input = document.getElementById(inputId);
      const eye = icon || document.getElementById('togglePassword');
      if (input.type === 'password') {
        input.type = 'text';
        eye.classList.remove('fa-eye');
        eye.classList.add('fa-eye-slash');
      } else {
        input.type = 'password';
        eye.classList.remove('fa-eye-slash');
        eye.classList.add('fa-eye');
      }
    }

    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();
      const btn = document.getElementById('loginBtn');
      const spinner = document.getElementById('spinner');
      const btnText = document.getElementById('btnText');
      const errorMsg = document.getElementById('errorMsg');

      usernameInput.classList.remove("input-error");
      passwordInput.classList.remove("input-error");
      errorMsg.style.display = "none";

      let hasError = false;

      if (!username) {
        usernameInput.classList.add("input-error");
        hasError = true;
      }
      if (!password) {
        passwordInput.classList.add("input-error");
        hasError = true;
      }

      if (hasError) {
        errorMsg.textContent = "Preencha todos os campos corretamente.";
        errorMsg.style.display = "block";
        return;
      }

      btn.disabled = true;
      spinner.style.display = "block";
      btnText.style.visibility = "hidden";

      setTimeout(() => {
        localStorage.setItem('nomeUsuario', username);
        window.location.href = 'painel.html';
      }, 1200);
    });

    function abrirCadastro(e) {
      e.preventDefault();
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('cadastroForm').style.display = 'block';
    }

    function voltarLogin(e) {
      e.preventDefault();
      document.getElementById('cadastroForm').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
    }

    ["username", "password", "cadNome", "cadUsuario", "cadSenha", "cadPelotao"].forEach(id => {
      const input = document.getElementById(id);
      input.addEventListener("input", function () {
        this.classList.remove("input-error");
      });
    });

    document.getElementById("cadastroForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const nome = document.getElementById("cadNome");
      const email = document.getElementById("cadEmail");
      const usuario = document.getElementById("cadUsuario");
      const senha = document.getElementById("cadSenha");
      const pelotao = document.getElementById("cadPelotao");
      const successMsg = document.getElementById("cadastroSuccess");

      [nome, email, usuario, senha, pelotao].forEach(input => {
        input.classList.remove("input-error");
      });
      successMsg.style.display = "none";

      let erro = false;

      if (!nome.value.trim()) { nome.classList.add("input-error"); erro = true; }
      if (!usuario.value.trim()) { usuario.classList.add("input-error"); erro = true; }

      if (!email.value.trim() || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value.trim())) {
        email.classList.add("input-error");
        erro = true;
      }

      if (!senha.value.trim()) { senha.classList.add("input-error"); erro = true; }
      if (!pelotao.value.trim()) { pelotao.classList.add("input-error"); erro = true; }

      if (erro) {
  document.getElementById("cadastroErro").style.display = "block";
  return;
}

      document.getElementById("cadastroBtn").textContent = "Enviado ✔️";
      document.getElementById("cadastroBtn").disabled = true;
      successMsg.style.display = "block";

      // Aqui você pode integrar com Firebase se quiser
    });
  function abrirModalEsqueciSenha(e) {
  e.preventDefault();
  document.getElementById("modalEsqueciSenha").style.display = "flex";
}

function fecharModalEsqueciSenha(e) {
  e.preventDefault();
  document.getElementById("modalEsqueciSenha").style.display = "none";
}

// Simulando envio do formulário de recuperação
const recuperarForm = document.getElementById("recuperarForm");
if (recuperarForm) {
  recuperarForm.addEventListener("submit", function(e) {
    e.preventDefault();
    const msg = document.getElementById("recuperarMsg");
    msg.innerHTML = "<strong>Solicitação enviada com sucesso!</strong><br>Você receberá instruções de redefinição de senha no seu e-mail.";
    msg.style.display = "block";
    setTimeout(() => fecharModalEsqueciSenha(e), 3000);
  });
}

</script>
</body>
</html>
